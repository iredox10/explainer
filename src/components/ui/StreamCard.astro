---
import { serverStoryService } from "../../lib/server-appwrite.js";

interface Props {
  article: {
    title?: string;
    headline?: string;
    category?: string;
    author?: string;
    imageUrl?: string;
    heroImage?: string;
    readTime?: string;
    slug?: string;
    content?: any;
  };
}

const { article } = Astro.props;
const displayTitle = article.headline || article.title;
const displayImage = article.imageUrl || article.heroImage;
const displayCategory = article.category || "General";
const readTime = article.content
  ? serverStoryService.calculateReadTime(article.content)
  : 5;
const displayReadTime = `${readTime} min read`;
---

<article
  class="group flex flex-col md:flex-row gap-6 items-start py-8 border-t border-dashed border-gray-300 first:border-t-0"
>
  <!-- Content -->
  <div class="flex-1 order-2 md:order-1">
    <div class="flex items-center gap-2 mb-3">
      <span
        class="text-xs font-black uppercase tracking-widest text-black bg-yellow-300 px-1"
      >
        {displayCategory}
      </span>
      <span class="text-xs text-gray-400 uppercase tracking-wider font-bold"
        >{article.readTime || displayReadTime}</span
      >
    </div>

    <h3
      class="font-serif-display text-2xl md:text-3xl font-bold leading-tight text-black mb-3"
    >
      <a
        href={article.slug ? `/article/${article.slug}` : "#"}
        class="group-hover:text-gray-600 transition-colors"
      >
        {displayTitle}
      </a>
    </h3>

    <p class="text-gray-500 text-sm leading-relaxed line-clamp-2 mb-3">
      Detailed analysis on why this matters now and how it affects the broader
      landscape of global events.
    </p>

    <a
      href={article.slug ? `/article/${article.slug}` : "#"}
      class="text-xs font-bold uppercase tracking-widest border-b-2 border-black pb-0.5 hover:bg-yellow-300 hover:border-transparent transition-colors"
    >
      Read Story
    </a>
  </div>

  <!-- Image -->
  <div class="w-full md:w-48 aspect-[4/3] overflow-hidden order-1 md:order-2">
    <img
      src={displayImage}
      alt={displayTitle}
      class="w-full h-full object-cover grayscale group-hover:grayscale-0 transition-all duration-500 group-hover:scale-105"
    />
  </div>
</article>
